---
tags:
  - Post-Exploitation
  - OperatingSystems
  - Windows
  - Concepts
  - Vulnerabilities
aliases:
  - PtH
  - Pass the Hash
---
A [Pass the Hash (PtH)](https://attack.mitre.org/techniques/T1550/002/) attack is a technique where an attacker uses a password hash instead of the plain text password for authentication. The attacker doesn't need to decrypt the hash to obtain a plaintext password. PtH attacks exploit the authentication protocol, as the password hash remains static for every session until the password is changed.
## Guides

1. [Practical Usage of NTLM Hashes - ropnop blog](https://blog.ropnop.com/practical-usage-of-ntlm-hashes/#long-live-pth)


> [!NOTE]
> Since the Microsoft [**MS08-068**](https://docs.microsoft.com/en-us/security-updates/securitybulletins/2008/ms08-068) vulnerability patch, you cannot relay NTLMv1/v2 authentication to the same machine from which it came. 
> You also cannot relay saved hashes that you’ve collected with [[1. Responder|Responder]].

## Methods

#### Pass the Hash Toolkit

See [[pth-toolkit]]

#### Evil-WinRM

See [[Evil-WinRM]]

```shell-session
evil-winrm -i 10.129.201.57  -u  Administrator -H "64f12cddaa88057e06a81b54e73b949b"
```

#### Mimikatz

See [[Mimikatz]]
#### Invoke-TheHash

See [[Invoke-TheHash]]
#### Impacket

See [[Impacket]]
#### CrackMapExec

See [[CrackMapExec]]. Useful for checking multiple hosts within a subdomain for repeated hashes.
#### RDP

See [[xFreeRDP]]

`Restricted Admin Mode`, which is disabled by default, should be enabled on the target host; otherwise, you will be presented with the following error: 

"Account restrictions are preventing this user from signing in. for example: blank passwords aren't allowed, sign-in times are limited, or a policy restriction has been enforced"

## Remediation

UAC (User Account Control) limits local users' ability to perform remote administration operations. When the registry key `HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy` is set to 0, it means that the built-in local admin account (RID-500, "Administrator") is the only local account allowed to perform remote administration tasks. Setting it to 1 allows the other local admins as well.

> [!NOTE]
> There is one exception, if the registry key `FilterAdministratorToken` (disabled by default) is enabled (value 1), the RID 500 account (even if it is renamed) is enrolled in UAC protection. This means that remote PTH will fail against the machine when using that account.

[Pass-the-Hash Is Dead: Long Live LocalAccountTokenFilterPolicy | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/pass-the-hash-is-dead-long-live-localaccounttokenfilterpolicy-506c25a7c167)
