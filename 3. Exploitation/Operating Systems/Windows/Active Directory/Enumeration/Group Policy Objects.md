We can use [[PowerView SharpView]], [[Bloodhound]], and [[Group3r]] to enumerate Group Policy security misconfigurations. This section will show some of the enumeration techniques we can perform on the command line using `PowerView` and `SharpView`.

## GPO Abuse

GPOs can be abused to perform attacks such as adding additional rights to a user, adding a local admin, or creating an immediate scheduled task. There are several ways to gain persistence via GPOs:

- Configure a GPO to run any of the above attacks.
- Create a scheduled task to modify group membership, add an account, run DCSync, or send back a reverse shell connection.
- Install targeted malware across the entire Domain.

[[SharpGPOAbuse]] is a tool which can take advantage of GPO misconfigurations.

Gathering GPO names

```powershell-session
Get-DomainGPO | select displayname
```

We can also check which GPOs apply to a specific computer.

```powershell-session
Get-DomainGPO -ComputerName WS01 | select displayname
```

Analyzing the GPO names can give us an idea of some of the security configurations in the target domain, such as LAPS, AppLocker, PowerShell Logging, cmd.exe disabled for workstations, etc. We can check for hosts/users that these GPOs are not applied to and plan out our attack paths for circumventing these controls.

If we do not have tools available to us, we can use [gpresult](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult), which is a built-in tool that determines GPOs that have been applied to a given user or computer and their settings. We can use specific commands to see the GPOs applied to a specific user and computer, respectively, such as:

```cmd-session
gpresult /r /user:harry.jones
```

```cmd-session
gpresult /r /S WS01
```

The tool can output in HTML format with a command such as `gpresult /h gpo_report.html`.

## GPO Permissions

We can use the `Get-DomainGPO` and `Get-ObjectAcl` using the SID for the `Domain Users` group to see if this group has any permissions assigned to any GPOs.

```powershell-session
Get-DomainGPO | Get-ObjectAcl | ? {$_.SecurityIdentifier -eq 'S-1-5-21-2974783224-3764228556-2640795941-513'}
```

From the result, we can see that one GPO allows all Domain Users full write access. We can then confirm the name of the GPO using the built-in cmdlet `Get-GPO`.

```powershell-session
Get-GPO -Guid 831DE3ED-40B1-4703-ABA7-8EA13B2EB118
```



