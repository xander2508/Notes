Armed with the domain user information, it is next important to gather AD group information to see what privileges members of a group may have and even find nested groups or issues with group membership that could lead to unintended rights.

```powershell-session
Get-DomainGroup -Properties Name
```

Let's grab a full listing of the group names. Many of these are built-in, standard AD groups. The presence of some group shows us that Microsoft Exchange is present in the environment. An Exchange installation adds several groups to AD, some of which such as `Exchange Trusted Subsystem` and `Exchange Windows Permissions` are considered [high-value targets](https://github.com/gdedrouas/Exchange-AD-Privesc) due to the permissions that membership in these groups grants a user or computer. Other groups such as `Protected Users`, `LAPS Admins`, `Help Desk`, and `Security Operations` should be noted down for review.

We can use `Get-DomainGroupMember` to examine group membership in any given group.

```powershell-session
.\SharpView.exe Get-DomainGroupMember -Identity 'Help Desk'
```

Next, we can look for all AD groups with the `AdminCount` attribute set to 1, signifying that this is a protected group.

```powershell-session
.\SharpView.exe Get-DomainGroup -AdminCount
```

Another important check is to look for any managed security groups. These groups have delegated non-administrators the right to add members to AD security groups and [distribution groups](https://docs.microsoft.com/en-us/exchange/recipients-in-exchange-online/manage-distribution-groups/manage-distribution-groups) and is set by modifying the `managedBy` attribute. This check looks to see if a group has a manager set and if the user can add users to the group. This could be useful for lateral movement by gaining us access to additional resources. First, let's take a look at the list of managed security groups.

```powershell-session
Find-ManagedSecurityGroups | select GroupName
```

#### Security Operations Group

Next, let's look at the `Security Operations` group and see if the group has a manager set. We can see that the user `joe.evans` is set as the group manager.

```powershell-session
Get-DomainManagedSecurityGroup

GroupName                : Security Operations
GroupDistinguishedName   : CN=Security Operations,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
ManagerName              : joe.evans
ManagerDistinguishedName : CN=Joe Evans,OU=Security,OU=IT,OU=Employees,DC=INLANEFREIGHT,DC=LOCAL
ManagerType              : User
ManagerCanWrite          : UNKNOWN

GroupName                : Organization Management
GroupDistinguishedName   : CN=Organization Management,OU=Microsoft Exchange Security Groups,DC=INLANEFREIGHT,DC=LOCAL
ManagerName              : Organization Management
ManagerDistinguishedName : CN=Organization Management,OU=Microsoft Exchange Security Groups,DC=INLANEFREIGHT,DC=LOCAL
ManagerType              : Group
ManagerCanWrite          : UNKNOWN

GroupName                : Recipient Management
GroupDistinguishedName   : CN=Recipient Management,OU=Microsoft Exchange Security Groups,DC=INLANEFREIGHT,DC=LOCAL
ManagerName              : Organization Management
ManagerDistinguishedName : CN=Organization Management,OU=Microsoft Exchange Security Groups,DC=INLANEFREIGHT,DC=LOCAL
ManagerType              : Group
ManagerCanWrite          : UNKNOWN

GroupName                : View-Only Organization Management
GroupDistinguishedName   : CN=View-Only Organization Management,OU=Microsoft Exchange Security
                           Groups,DC=INLANEFREIGHT,DC=LOCAL
ManagerName              : Organization Management
ManagerDistinguishedName : CN=Organization Management,OU=Microsoft Exchange Security Groups,DC=INLANEFREIGHT,DC=LOCAL
ManagerType              : Group
ManagerCanWrite          : UNKNOWN
```

Enumerating the ACLs set on this group, we can see that this user has `GenericWrite` privileges meaning that this user can modify group membership (add or remove users). If we gain control of this user account, we can add this account or any other account that we control to the group and inherit any privileges that it has in the domain.

```powershell-session
$sid = ConvertTo-SID joe.evans

Get-DomainObjectAcl -Identity 'Security Operations' | ?{ $_.SecurityIdentifier -eq $sid}

ObjectDN              : CN=Security Operations,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
ObjectSID             : S-1-5-21-2974783224-3764228556-2640795941-2127
ActiveDirectoryRights : ListChildren, ReadProperty, GenericWrite
BinaryLength          : 36
AceQualifier          : AccessAllowed
IsCallback            : False
OpaqueLength          : 0
AccessMask            : 131132
SecurityIdentifier    : S-1-5-21-2974783224-3764228556-2640795941-1238
AceType               : AccessAllowed
AceFlags              : ContainerInherit
IsInherited           : False
InheritanceFlags      : ContainerInherit
PropagationFlags      : None
AuditFlags            : None
```


## Local Groups

It is also important to check local group membership. Is our current user local admin or part of local groups on any hosts? We can get a list of the local groups on a host using `Get-NetLocalGroup`.

```powershell-session
Get-NetLocalGroup -ComputerName WS01 | select GroupNam
```



















