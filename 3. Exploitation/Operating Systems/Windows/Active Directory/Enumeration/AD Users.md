When starting enumeration in an AD environment, arguably, the most important objects are domain users. Users have access to computers and are assigned permissions to perform a variety of functions throughout the domain. We need to control user accounts to move laterally and vertically within a network to reach the assessment goal.

Any time you see SharpView usage, it should be possible to do it in PowerView by just removing SharpView.exe. SharpView does not have the latest PowerSploit features, so it may not be possible to run PowerView commands within SharpView.

We can use [[PowerView SharpView]]  to enumerate a wealth of information about AD users. We can start by getting a count of how many users are in the target domain.

```powershell-session
(Get-DomainUser).count
```

```powershell-session
PS C:\htb> Get-DomainUser -Identity harry.jones -Domain inlanefreight.local | Select-Object -Property name,samaccountname,description,memberof,whencreated,pwdlastset,lastlogontimestamp,accountexpires,admincount,userprincipalname,serviceprincipalname,mail,useraccountcontrol
```

It is useful to enumerate these properties for ALL domain users and export them to a CSV file for offline processing.

```powershell-session
Get-DomainUser * -Domain inlanefreight.local | Select-Object -Property name,samaccountname,description,memberof,whencreated,pwdlastset,lastlogontimestamp,accountexpires,admincount,userprincipalname,serviceprincipalname,mail,useraccountcontrol | Export-Csv .\inlanefreight_users.csv -NoTypeInformation
```

Once we have gathered information on all users, we can begin to perform more specific user enumeration by obtaining a list of users that do not require Kerberos pre-authentication and can be subjected to an ASREPRoast attack.

```powershell-session
.\SharpView.exe Get-DomainUser -KerberosPreauthNotRequired -Properties samaccountname,useraccountcontrol,memberof
```

Let's also gather information about users with Kerberos constrained delegation.

```powershell-session
.\SharpView.exe Get-DomainUser -TrustedToAuth -Properties samaccountname,useraccountcontrol,memberof
```

While we're at it, we can look for users that allow unconstrained delegation.

```powershell-session
.\SharpView.exe Get-DomainUser -LDAPFilter "(userAccountControl:1.2.840.113556.1.4.803:=524288)"
```

We can also check for any domain users with sensitive data such as a password stored in the description field.

```powershell-session
Get-DomainUser -Properties samaccountname,description | Where {$_.description -ne $null}
```

Enumerate any users with Service Principal Names (SPNs) that could be subjected to a Kerberoasting attack.

```powershell-session
.\SharpView.exe Get-DomainUser -SPN -Properties samaccountname,memberof,serviceprincipalname
```

Enumerate any users from other (foreign) domains with group membership within any groups in our current domain.

```powershell-session
Find-ForeignGroup
```

Convert found member SIDs to usernames:

```powershell-session
Convert-SidToName S-1-5-21-888139820-103978830-333442103-1602
```

Another useful command is checking for users with Service Principal Names (SPNs) set in other domains that we can authenticate into via inbound or bi-directional trust relationships with forest-wide authentication allowing all users to authenticate across a trust or selective-authentication set up which allows specific users to authenticate.

```powershell-session
Get-DomainUser -SPN -Domain freightlogistics.local | select samaccountname,memberof,serviceprincipalname | fl
```

See [[3. Password Analysis]]