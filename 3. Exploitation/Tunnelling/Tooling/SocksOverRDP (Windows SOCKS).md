---
tags:
  - Exploitation
  - Tunnelling
  - Tooling
  - SSHTunnelling
---
There are often times during an assessment when we may be limited to a Windows network and may not be able to use SSH for pivoting. We would have to use tools available for Windows operating systems in these cases.

 [SocksOverRDP](https://github.com/nccgroup/SocksOverRDP) is an example of a tool that uses `Dynamic Virtual Channels` (`DVC`) from the Remote Desktop Service feature of Windows. DVC is responsible for tunnelling packets over the RDP connection. Some examples of usage of this feature would be clipboard data transfer and audio sharing. However, this feature can also be used to tunnel arbitrary packets over the network. We can use `SocksOverRDP` to tunnel our custom packets and then proxy through it.


## Installation

1. [SocksOverRDP x64 Binaries](https://github.com/nccgroup/SocksOverRDP/releases)
2. [Proxifier Portable Binary](https://www.proxifier.com/download/#win-tab) (Windows Proxychains)


## Usage

#### On Attack Server as Admin

```cmd-session
regsvr32.exe SocksOverRDP-Plugin.dll
```

Every time you connect to an RDP server from now on, this plugin will be loaded and will configure itself as it was specified in the registry.

#### On the proxy server

Windows Defender will delete the executable  constantly

```powershell-session
Uninstall-WindowsFeature -Name Windows-Defender
```

Run as Admin

```
.\SocksOverRDP-Server.exe
```

After connecting to the proxy server, when we go back to our foothold target and check with Netstat, we should see our SOCKS listener started on 127.0.0.1:1080.

#### Confirming the SOCKS Listener is Started

```cmd-session
netstat -antb | findstr 1080
```

After starting our listener, we can transfer Proxifier portable to the Windows 10 target (on the 10.129.x.x network), and configure it to forward all our packets to 127.0.0.1:1080. Proxifier will route traffic through the given host and port. See the clip below for a quick walkthrough of configuring Proxifier. As Admin

![[configuringproxifier.gif]]
With Proxifier configured and running, we can start mstsc.exe, and it will use Proxifier to pivot all our traffic via 127.0.0.1:1080, which will tunnel it over RDP to 172.16.5.19, which will then route it to 172.16.6.155 using SocksOverRDP-server.exe.



